{% extends "pages/casino/base.html" %}

{% block title %}
Salas multijugador
{% endblock %}

{% block content %}
<div class="row justify-content-center mb-5 g-4">
    <div class="col-12">
        <div class="text-center animated-scaleup">
            <h1 class="hero-title"><i class="fas fa-people-roof me-3"></i>Salas Multijugador</h1>  
            <p class="hero-subtitle mt-4 mb-1">
                Crea o Ãºnete a salas para jugar con otros usuarios en tiempo real en cualquiera de los siguientes juegos:
            </p>
        </div>
    </div>
    {% for juego in [
        {"emoji": "ğŸ²", "nombre": "Blackjack"},
        {"emoji": "ğŸ‡", "nombre": "Carrera de caballos"},
        {"emoji": "ğŸª™", "nombre": "Coinflip"},
        {"emoji": "ğŸƒ", "nombre": "PÃ³ker"},
        {"emoji": "ğŸ¯", "nombre": "Ruleta europea"},
    ] %}
    <div class="col-6 col-sm-4 col-md-3 col-xl-2">
        <div class="card translucent-card card-body animated-rotate p-2 text-center h-100">
            <div class="fs-1 mb-2">{{ juego.emoji }}</div>
            <h3 class="card-title fs-5">{{ juego.nombre }}</h3>
        </div>
    </div>
    {% endfor %}
</div>

<div class="row">
    <!-- Panel de Crear Sala -->
    <div class="col-md-4 mb-4">
        <div class="card animated-translateY">
            <div class="card-header">
                <i class="fas fa-plus-circle me-2"></i>Crear Sala
            </div>
            <div class="card-body">
                <form method="POST" action="{{ url_for('salas_espera.crear_sala') }}">
                    <div class="mb-3">
                        <label class="form-label fw-bold mb-1">Nombre de la sala</label>
                        <input type="text" class="form-control" name="nombre" required 
                               placeholder="Ej: Torneo Blackjack Pro">
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label fw-bold mb-1">Juego</label>
                        <select class="form-select" name="juego" required id="select-juego" onchange="actualizarCapacidad()">
                            <option value="">Selecciona un juego</option>
                            <option value="blackjack">ğŸ² Blackjack (de 2 a 4 jugadores)</option>
                            <option value="caballos">ğŸ‡ Carrera de caballos (4 jugadores)</option>
                            <option value="coinflip">ğŸª™ Coinflip (2 jugadores)</option>
                            <option value="poker">ğŸƒ PÃ³ker (de 2 a 4 jugadores)</option>
                            <option value="ruleta">ğŸ¯ Ruleta europea (de 2 a 4 jugadores)</option>
                        </select>
                    </div>

                    <div class="mb-3">
                        <label class="form-label fw-bold mb-1">Capacidad</label>
                        <select class="form-select" name="capacidad" id="select-capacidad">
                            <!-- Se actualizarÃ¡ dinÃ¡micamente -->
                        </select>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label fw-bold mb-1">Apuesta mÃ­nima</label>
                        <div class="input-group">
                            <span class="input-group-text">
                                <i class="fas fa-dollar-sign"></i>
                            </span>
                            <input type="number" class="form-control" name="apuesta_minima" 
                               value="10.0" placeholder="Cantidad" min="1" step="0.5" required>
                        </div>
                    </div>
                    
                    <button type="submit" class="btn btn-primary w-100">
                        <i class="fas fa-gamepad me-2"></i>Crear sala
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- Lista de Salas Disponibles -->
    <div class="col-md-8">
        <div class="card animated-translateY">
            <div class="card-header">
                <i class="fas fa-list me-2"></i>Salas Disponibles
            </div>
            <div class="card-body">
                <div id="salas-container">
                    <!-- NO cambiar identificador, es necesario para que la lista se actualice periÃ³dicamente -->
                    {% include "partials/lista_salas.html" %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<!-- Para actualizaciÃ³n automÃ¡tica de la lista de salas multijugador -->
<script>
    // Crear instancia de actualizador de contenedor de la lista de salas de espera.
    const salasContainerUpd = new ContainerUpdater('#salas-container');

    // AÃ±adir actualizaciÃ³n sin recarga con el paginador.
    addPaginationUpdate(salasContainerUpd);
    // AÃ±adir recarga automÃ¡tica cada 20 segundos.
    addAutoReload(salasContainerUpd, 20000);
</script>

<script>
function actualizarCapacidad() {
    const juegoSelect = document.getElementById('select-juego');
    const capacidadSelect = document.getElementById('select-capacidad');
    const juego = juegoSelect.value;
    
    // Limpiar opciones actuales
    capacidadSelect.innerHTML = '';
    
    // Definir capacidades por juego
    let capacidades = [];
    switch(juego) {
        case 'coinflip':
            capacidades = [2];
            break;
        case 'caballos':
            capacidades = [4];
            break;
        case 'blackjack':
        case 'poker':
        case 'ruleta':
            capacidades = [2, 3, 4];
            break;
        default:
            capacidades = [2, 3, 4];
    }
    
    // AÃ±adir opciones
    capacidades.forEach(cap => {
        const option = document.createElement('option');
        option.value = cap;
        option.textContent = `${cap} Jugadores`;
        if (cap === Math.max(...capacidades)) {
            option.selected = true;
        }
        capacidadSelect.appendChild(option);
    });
}

// Inicializar al cargar la pÃ¡gina
document.addEventListener('DOMContentLoaded', function() {
    actualizarCapacidad();
});
</script>
{% endblock %}