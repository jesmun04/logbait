{% extends "pages/casino/base.html" %}

{% block title %}
Salas multijugador
{% endblock %}

{% block content %}
<div class="simple-background"></div>

<div class="text-center mb-5">
    <h1 class="hero-title">Salas de Espera</h1>  
    <p class="hero-subtitle mt-4">
        Crea o únete a salas para jugar con otros usuarios en tiempo real
    </p>
</div>

<div class="row">
    <!-- Panel de Crear Sala -->
    <div class="col-md-4 mb-4">
        <div class="card hover-card">
            <div class="card-header">
                <h4 class="mb-0"><i class="fas fa-plus-circle me-2"></i>Crear Sala</h4>
            </div>
            <div class="card-body">
                <form method="POST" action="{{ url_for('salas_espera.crear_sala') }}">
                    <div class="mb-3">
                        <label class="form-label">Nombre de la Sala</label>
                        <input type="text" class="form-control" name="nombre" required 
                               placeholder="Ej: Torneo Blackjack Pro">
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">Juego</label>
                        <select class="form-select" name="juego" required id="select-juego" onchange="actualizarCapacidad()">
                            <option value="">Selecciona un juego</option>
                            <option value="coinflip">Coinflip (2 jugadores)</option>
                            <option value="caballos">Carrera de Caballos (4 jugadores)</option>
                            <option value="blackjack">Blackjack (4 jugadores)</option>
                            <option value="poker">Póker (4 jugadores)</option>
                            <option value="ruleta">Ruleta (4 jugadores)</option>
                        </select>
                    </div>

                    <div class="mb-3">
                        <label class="form-label">Capacidad</label>
                        <select class="form-select" name="capacidad" id="select-capacidad">
                            <!-- Se actualizará dinámicamente -->
                        </select>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">Apuesta Mínima</label>
                        <input type="number" class="form-control" name="apuesta_minima" 
                               value="10.0" min="1" step="0.5" required>
                    </div>
                    
                    <button type="submit" class="btn btn-primary w-100">
                        <i class="fas fa-gamepad me-2"></i>Crear Sala
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- Lista de Salas Disponibles -->
    <div class="col-md-8">
        <div class="card">
            <div class="card-header">
                <h4 class="mb-0"><i class="fas fa-list me-2"></i>Salas Disponibles</h4>
            </div>
            <div class="card-body">
                <div id="salas-container">
                    <!-- NO cambiar identificador, es necesario para que la lista se actualice periódicamente -->
                    {% include "partials/lista_salas.html" %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<!-- Para actualización automática de la lista de salas multijugador -->
<script>
    // Crear instancia de actualizador de contenedor de la lista de salas de espera.
    const salasContainerUpd = new ContainerUpdater('#salas-container');

    // Añadir actualización sin recarga con el paginador.
    addPaginationUpdate(salasContainerUpd);
    // Añadir recarga automática cada 20 segundos.
    addAutoReload(salasContainerUpd, 20000);
</script>

<script>
function actualizarCapacidad() {
    const juegoSelect = document.getElementById('select-juego');
    const capacidadSelect = document.getElementById('select-capacidad');
    const juego = juegoSelect.value;
    
    // Limpiar opciones actuales
    capacidadSelect.innerHTML = '';
    
    // Definir capacidades por juego
    let capacidades = [];
    switch(juego) {
        case 'coinflip':
            capacidades = [2];
            break;
        case 'caballos':
            capacidades = [4];
            break;
        case 'blackjack':
        case 'poker':
        case 'ruleta':
            capacidades = [2, 3, 4];
            break;
        default:
            capacidades = [2, 3, 4];
    }
    
    // Añadir opciones
    capacidades.forEach(cap => {
        const option = document.createElement('option');
        option.value = cap;
        option.textContent = `${cap} Jugadores`;
        if (cap === Math.max(...capacidades)) {
            option.selected = true;
        }
        capacidadSelect.appendChild(option);
    });
}

// Inicializar al cargar la página
document.addEventListener('DOMContentLoaded', function() {
    actualizarCapacidad();
});
</script>
{% endblock %}